CREATE TABLE STATS (
                       STAT_ID INT(11) AUTO_INCREMENT PRIMARY KEY ,
                       STAT_DATE DATETIME NOT NULL,
                       STAT VARCHAR(20) NOT NULL,
                       VALUE INT(11) NOT NULL
);

DROP VIEW IF EXISTS BESTSELLER_COUNT;

CREATE VIEW BESTSELLER_COUNT AS
SELECT COUNT(*) AS BESTSELLERS FROM BOOKS
WHERE BESTSELLER = 1;


select * from BESTSELLER_COUNT;

DROP EVENT IF EXISTS UPDATE_BESTSELLERS_COUNT;

CREATE EVENT UPDATE_BESTSELLERS_COUNT
    ON SCHEDULE EVERY 5 MINUTE
    DO
    CALL UpdateBestSellers();
INSERT INTO STATS (STAT_DATE, STAT, VALUE) VALUES (CURDATE(), 'Bestsellers', (SELECT * FROM BESTSELLER_COUNT));

DROP EVENT UPDATE_BESTSELLERS_COUNT;

select * FROM STATS;